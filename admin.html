<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ—‚ï¸ Kunden verwalten - DÃ¶ner Boxx</title>
<link rel="icon" href="/favicon-new.png" type="image/png">
<link rel="apple-touch-icon" href="/apple-touch-icon-new.png">
<style>
@font-face { font-family: 'Flame'; src: url('Flame-Regular.ttf') format('truetype'); font-weight: normal; font-style: normal; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Flame', system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #E31E24 0%, #F9A825 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
.card { background: white; border-radius: 20px; padding: 24px; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.header-card { display: flex; align-items: center; gap: 20px; }
.header-logo { width: 80px; height: 80px; flex-shrink: 0; }
.header-logo img { width: 100%; height: 100%; object-fit: contain; }
.header-text { flex: 1; }
h1 { color: #E31E24; font-size: 28px; margin-bottom: 8px; }
h2 { color: #374151; font-size: 20px; margin-bottom: 16px; }
.subtitle { color: #6b7280; font-size: 14px; margin-bottom: 20px; }
button { padding: 12px 20px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
button.primary { background: linear-gradient(135deg, #E31E24, #F9A825); color: white; width: 100%; margin-bottom: 10px; }
button.primary:hover { opacity: 0.9; transform: translateY(-1px); }
button.success { background: #F9A825; color: white; width: 100%; margin-bottom: 10px; }
button.success:hover { background: #f59e0b; }
input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; margin-bottom: 10px; transition: all 0.2s; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #E31E24; }
.form-label { display: block; font-weight: 600; color: #374151; margin-bottom: 6px; font-size: 14px; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.result { padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 14px; text-align: center; font-weight: 600; }
.success { background: #fef3c7; color: #92400e; border: 2px solid #F9A825; }
.error { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
.info { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
</style>
</head>
<body>

<div class="container">
  <div class="card header-card">
    <div class="header-logo"><img src="/logo-round-new.png" alt="DÃ¶ner Boxx"></div>
    <div class="header-text"><h1>Kunden verwalten</h1><p class="subtitle">Admin Panel fÃ¼r DÃ¶ner Boxx</p></div>
  </div>

  <div class="card">
    <h2>ğŸŸï¸ Coupon-System (Deal der Woche)</h2>
    <p class="subtitle">Erstelle Angebote mit Start- und End-Datum</p>
    <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
      <h3 style="color: #92400e; margin-bottom: 12px;">Neuen Coupon erstellen</h3>
      
      <!-- âœ… GEÃ„NDERT: Dropdown statt Input -->
      <div class="form-grid">
        <div>
          <label class="form-label">ğŸ´ Produkt aus MenÃ¼ wÃ¤hlen</label>
          <select id="couponProduct" onchange="onProductSelect()" style="font-size: 14px;">
            <option value="">-- Bitte Produkt wÃ¤hlen --</option>
          </select>
        </div>
        <div>
          <label class="form-label">ğŸ’° Coupon-Preis (wird automatisch gefÃ¼llt, kann geÃ¤ndert werden)</label>
          <input type="text" id="couponPrice" placeholder="z.B. 5,50 â‚¬">
        </div>
      </div>
      
      <div class="form-grid">
        <div><label class="form-label">ğŸ“… Start-Datum</label><input type="date" id="couponStart"></div>
        <div><label class="form-label">ğŸ“… End-Datum</label><input type="date" id="couponEnd"></div>
      </div>
      <button class="success" onclick="createCoupon()">ğŸ Coupon erstellen</button>
      <div id="result-coupon-create"></div>
    </div>
    <div><h3>Aktuelle Coupons</h3><div id="result-coupon-load"></div><div id="couponList" style="margin-top: 12px;"></div></div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” LIZENZ & DOMAIN-SCHUTZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const _0xB = 'DÃ¶ner Boxx';
  const _0xL = 'DNBX-2025-LOYALTY-SYSTEM-PROTECTED';
  const _0xD = ['localhost', 'doener-boxx.vercel.app', 'doenerboxx.de', 'www.doenerboxx.de'];
  const _0xH = ['528de417', '88a8ce6b', 'a1f62429', '5da2c3a0'];
  
  const _0xHost = window.location.hostname;
  
  if (!_0xD.includes(_0xHost)) {
    document.body.innerHTML = '<div style="font-family:sans-serif;text-align:center;padding:50px;background:#1a1a1a;min-height:100vh;color:#ff4444;display:flex;flex-direction:column;align-items:center;justify-content:center;"><h1 style="font-size:48px;margin-bottom:20px;">â›”</h1><h2>LIZENZ UNGÃœLTIG</h2><p style="margin-top:15px;">Diese Software ist nicht fÃ¼r diese Domain lizenziert.</p></div>';
    throw new Error('Unauthorized domain');
  }
  
  function _0xHash(s) {
    let h = 0;
    for (let i = 0; i < s.length; i++) {
      h = (h * 31 + s.charCodeAt(i)) & 0xffffffff;
    }
    if (h < 0) h = h >>> 0;
    return h.toString(16);
  }
  
  const _0xCalc = _0xHash(_0xB + '|' + _0xHost + '|' + _0xL);
  
  if (!_0xH.includes(_0xCalc)) {
    document.body.innerHTML = '<div style="font-family:sans-serif;text-align:center;padding:50px;background:#1a1a1a;min-height:100vh;color:#ff4444;"><h1>â›” LIZENZFEHLER</h1></div>';
    throw new Error('Invalid license');
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” PASSWORT-SCHUTZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PASSWORT_HASH = 'efc68709a6bc20b7983129e56ce1d98739876e4274463aaece1a3edef374d47e';
const LOCKOUT_DURATION = 5 * 60 * 1000;
const MAX_VERSUCHE = 3;

function getAuthState() {
  const stored = localStorage.getItem('db_auth_state');
  if (!stored) return { versuche: MAX_VERSUCHE, gesperrtBis: null };
  try { return JSON.parse(stored); } catch(e) { return { versuche: MAX_VERSUCHE, gesperrtBis: null }; }
}

function setAuthState(state) {
  localStorage.setItem('db_auth_state', JSON.stringify(state));
}

function clearAuthState() {
  localStorage.removeItem('db_auth_state');
}

function isLocked() {
  const state = getAuthState();
  if (state.gesperrtBis && Date.now() < state.gesperrtBis) return true;
  if (state.gesperrtBis && Date.now() >= state.gesperrtBis) clearAuthState();
  return false;
}

function getRemainingLockTime() {
  const state = getAuthState();
  if (!state.gesperrtBis) return 0;
  return Math.max(0, Math.ceil((state.gesperrtBis - Date.now()) / 1000));
}

async function sha256(text) {
  const encoder = new TextEncoder();
  const data = encoder.encode(text);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
}

function showLockScreen() {
  const updateTimer = () => {
    const remaining = getRemainingLockTime();
    if (remaining <= 0) {
      clearAuthState();
      location.reload();
      return;
    }
    const minutes = Math.floor(remaining / 60);
    const seconds = remaining % 60;
    const timerEl = document.getElementById('lockTimer');
    if (timerEl) timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };
  
  document.body.innerHTML = `
    <div style="font-family:'Flame',system-ui,sans-serif;background:linear-gradient(135deg,#dc2626,#991b1b);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;">
      <div style="background:white;border-radius:20px;padding:40px;max-width:400px;width:100%;box-shadow:0 10px 40px rgba(0,0,0,0.3);text-align:center;">
        <div style="font-size:60px;margin-bottom:20px;">ğŸš«</div>
        <h1 style="color:#dc2626;margin-bottom:10px;font-size:24px;">Zugriff gesperrt</h1>
        <p style="color:#666;margin-bottom:20px;">Zu viele Fehlversuche!</p>
        <div style="background:#fee2e2;border:2px solid #dc2626;border-radius:12px;padding:20px;margin-bottom:20px;">
          <p style="color:#991b1b;font-size:14px;margin-bottom:10px;">Sperre endet in:</p>
          <div id="lockTimer" style="font-size:36px;font-weight:700;color:#dc2626;">5:00</div>
        </div>
      </div>
    </div>
  `;
  updateTimer();
  setInterval(updateTimer, 1000);
}

function showLoginScreen() {
  if (isLocked()) {
    showLockScreen();
    return;
  }
  
  const state = getAuthState();
  const versuche = state.versuche;
  
  document.body.innerHTML = `
    <div style="font-family:'Flame',system-ui,sans-serif;background:linear-gradient(135deg,#E31E24,#F9A825);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;">
      <div style="background:white;border-radius:20px;padding:40px;max-width:400px;width:100%;box-shadow:0 10px 40px rgba(0,0,0,0.2);text-align:center;">
        <div style="font-size:60px;margin-bottom:20px;">ğŸ”</div>
        <h1 style="color:#E31E24;margin-bottom:10px;font-size:24px;">DÃ¶ner Boxx Admin</h1>
        <p style="color:#666;margin-bottom:30px;">Bitte Passwort eingeben</p>
        <input type="password" id="loginPassword" placeholder="Passwort" style="width:100%;padding:14px;border:2px solid #e5e7eb;border-radius:10px;font-size:16px;margin-bottom:15px;text-align:center;" onkeypress="if(event.key==='Enter')checkLogin()">
        <button onclick="checkLogin()" style="width:100%;padding:14px;background:linear-gradient(135deg,#E31E24,#F9A825);color:white;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;">ğŸ”“ Einloggen</button>
        <p id="loginError" style="color:#dc2626;margin-top:15px;font-size:14px;display:none;"></p>
        <p id="loginVersuche" style="color:#666;margin-top:10px;font-size:12px;">${versuche} Versuche Ã¼brig</p>
      </div>
    </div>
  `;
  setTimeout(() => document.getElementById('loginPassword').focus(), 100);
}

async function checkLogin() {
  if (isLocked()) {
    showLockScreen();
    return;
  }
  
  const eingabe = document.getElementById('loginPassword').value;
  const errorEl = document.getElementById('loginError');
  const versucheEl = document.getElementById('loginVersuche');
  
  if (!eingabe) {
    errorEl.textContent = 'âŒ Bitte Passwort eingeben!';
    errorEl.style.display = 'block';
    return;
  }
  
  const hash = await sha256(eingabe);
  
  if (hash === PASSWORT_HASH) {
    sessionStorage.setItem('db_auth', PASSWORT_HASH);
    clearAuthState();
    location.reload();
    return;
  }
  
  const state = getAuthState();
  state.versuche--;
  
  if (state.versuche <= 0) {
    state.gesperrtBis = Date.now() + LOCKOUT_DURATION;
    state.versuche = 0;
    setAuthState(state);
    showLockScreen();
    return;
  }
  
  setAuthState(state);
  
  errorEl.textContent = 'âŒ Falsches Passwort!';
  errorEl.style.display = 'block';
  versucheEl.textContent = state.versuche + ' Versuche Ã¼brig';
  document.getElementById('loginPassword').value = '';
  document.getElementById('loginPassword').focus();
}

if (isLocked()) {
  showLockScreen();
  throw new Error('Zugriff gesperrt');
}

if (sessionStorage.getItem('db_auth') !== PASSWORT_HASH) {
  showLoginScreen();
  throw new Error('Login erforderlich');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUPABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUPABASE_URL = 'https://pskuvrahvxlzrnxmuqnc.supabase.co'
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBza3V2cmFodnhsenJueG11cW5jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NTA2MTYsImV4cCI6MjA3ODEyNjYxNn0.Ji5dTEFsGbgW9t79yhJg-nOHkzc0Z0oHtVe6c-iBvds'
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¦ PRODUKTE AUS MENÃœ (19 StÃ¼ck) - âœ… NEU!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MENU_PRODUCTS = [
  { name: 'DÃ¶ner', price: 6.00 },
  { name: 'DÃ¶ner XL', price: 8.00 },
  { name: 'DÃ¶ner Box', price: 7.00 },
  { name: 'DÃ¼rÃ¼m DÃ¶ner', price: 7.00 },
  { name: 'DÃ¶ner Teller', price: 10.00 },
  { name: 'Lahmacun', price: 4.00 },
  { name: 'Lahmacun Spezial', price: 8.00 },
  { name: 'Rindswurst im BrÃ¶tchen', price: 3.50 },
  { name: 'Curry Rindswurst mit Pommes', price: 6.90 },
  { name: 'KÃ¶fte im Brot (5 Stk.)', price: 6.00 },
  { name: 'KÃ¶fte Teller (7 Stk.)', price: 11.00 },
  { name: 'Chicken Nuggets (6 Stk.)', price: 6.00 },
  { name: 'Crispy Chicken Burger', price: 4.00 },
  { name: 'Pommes', price: 3.50 },
  { name: 'Ayran (0,25 l)', price: 1.50 },
  { name: 'Wasser still (0,5 l)', price: 1.50 },
  { name: 'Cola (0,33 l)', price: 2.00 },
  { name: 'Fanta (0,33 l)', price: 2.00 },
  { name: 'Cola Zero (0,33 l)', price: 2.00 }
]

// âœ… NEU: Funktion die den Preis automatisch fÃ¼llt
function onProductSelect() {
  const select = document.getElementById('couponProduct')
  const priceInput = document.getElementById('couponPrice')
  
  const selectedProduct = MENU_PRODUCTS.find(p => p.name === select.value)
  
  if (selectedProduct) {
    // Setze Originalpreis
    priceInput.value = selectedProduct.price.toFixed(2) + ' â‚¬'
    priceInput.placeholder = 'Original: ' + selectedProduct.price.toFixed(2) + ' â‚¬'
  } else {
    priceInput.value = ''
    priceInput.placeholder = 'z.B. 5,50 â‚¬'
  }
}

function showResult(elementId, message, type) {
  const el = document.getElementById(elementId)
  if (!message) { el.className = ''; el.innerHTML = ''; return }
  el.className = `result ${type}`
  el.innerHTML = message
}

async function createCoupon() {
  const product = document.getElementById('couponProduct').value.trim()
  const price = document.getElementById('couponPrice').value.trim()
  const startDate = document.getElementById('couponStart').value
  const endDate = document.getElementById('couponEnd').value
  
  if (!product || !price) { 
    showResult('result-coupon-create', 'âŒ Bitte Produkt UND Preis ausfÃ¼llen!', 'error')
    return 
  }
  if (!startDate || !endDate) { 
    showResult('result-coupon-create', 'âŒ Bitte Start- und End-Datum wÃ¤hlen!', 'error')
    return 
  }
  if (endDate < startDate) { 
    showResult('result-coupon-create', 'âŒ End-Datum muss nach oder gleich Start-Datum sein!', 'error')
    return 
  }
  
  const today = new Date().toISOString().split('T')[0]
  if (startDate < today) { 
    showResult('result-coupon-create', 'âŒ Start-Datum darf nicht in der Vergangenheit liegen!', 'error')
    return 
  }
  
  showResult('result-coupon-create', 'ğŸ Erstelle Coupon...', 'info')
  
  try {
    const code = Math.floor(1000 + Math.random() * 9000).toString()
    
    const { error } = await supabase.from('coupons').insert({ 
      code: code, 
      title: 'Deal der Woche', 
      product: product, 
      price: price, 
      description: '', 
      start_date: startDate, 
      end_date: endDate, 
      expires_at: endDate, 
      is_active: true, 
      created_at: new Date().toISOString() 
    })
    
    if (error) throw error
    
    const start = new Date(startDate).toLocaleDateString('de-DE')
    const end = new Date(endDate).toLocaleDateString('de-DE')
    
    showResult('result-coupon-create', `âœ… Coupon erstellt!<br>Produkt: <strong>${product}</strong> fÃ¼r ${price}<br>ğŸ“… GÃ¼ltig: ${start} - ${end}`, 'success')
    
    document.getElementById('couponProduct').value = ''
    document.getElementById('couponPrice').value = ''
    
    loadCoupons()
  } catch (e) { 
    showResult('result-coupon-create', 'âŒ Fehler: ' + e.message, 'error') 
  }
}

async function loadCoupons() {
  try {
    const { data: coupons, error } = await supabase.from('coupons').select('*').order('created_at', { ascending: false })
    if (error) throw error
    
    const list = document.getElementById('couponList')
    
    if (!coupons || coupons.length === 0) { 
      list.innerHTML = '<div class="empty-state">Noch keine Coupons vorhanden</div>'
      showResult('result-coupon-load', '', 'info')
      return 
    }
    
    list.innerHTML = ''
    
    for (const coupon of coupons) {
      const startDate = coupon.start_date ? new Date(coupon.start_date) : new Date(coupon.created_at)
      const endDate = coupon.end_date ? new Date(coupon.end_date) : new Date(coupon.expires_at)
      endDate.setHours(23, 59, 59, 999)
      
      const now = new Date()
      const isExpired = endDate < now
      const isNotStarted = startDate > now
      const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24))
      
      if (isExpired && coupon.is_active) { 
        await supabase.from('coupons').update({ is_active: false }).eq('id', coupon.id)
        coupon.is_active = false 
      }
      
      const { data: activations } = await supabase
        .from('activated_coupons')
        .select('customer_id, unique_code, is_used, activated_at, customers(name, phone)')
        .eq('coupon_id', coupon.id)
        .order('activated_at', { ascending: false })

      let uniqueCustomers = 0
      if (activations && activations.length > 0) {
        const uniqueCustomerIds = new Set(activations.map(a => a.customer_id))
        uniqueCustomers = uniqueCustomerIds.size
      }

      let activationsHTML = ''
      if (uniqueCustomers > 0) { 
        activationsHTML = `<div style="margin-top: 12px; padding: 8px; background: #f3f4f6; border-radius: 6px;"><strong>ğŸ‘¥ Aktiviert von ${uniqueCustomers} Kunde(n)</strong></div>` 
      }
      
      let statusText = '', statusColor = '', statusBg = ''
      if (isExpired) { 
        statusText = 'âŒ Abgelaufen'
        statusColor = '#991b1b'
        statusBg = '#fee2e2' 
      }
      else if (isNotStarted) { 
        statusText = 'â° Startet bald'
        statusColor = '#92400e'
        statusBg = '#fef3c7' 
      }
      else if (daysLeft === 0) { 
        statusText = 'âš ï¸ LÃ¤uft heute ab!'
        statusColor = '#991b1b'
        statusBg = '#fee2e2' 
      }
      else if (daysLeft <= 3) { 
        statusText = `â° ${daysLeft} Tage`
        statusColor = '#92400e'
        statusBg = '#fef3c7' 
      }
      else { 
        statusText = `â° ${daysLeft} Tage`
        statusColor = '#92400e'
        statusBg = '#fef3c7' 
      }
      
      let descHTML = coupon.description ? `<p style="color: #6b7280; font-size: 13px; margin: 3px 0;">ğŸ“ ${coupon.description}</p>` : ''
      
      list.innerHTML += `
        <div style="background: #f9fafb; border: 2px solid ${isExpired ? '#ef4444' : '#e5e7eb'}; border-radius: 12px; padding: 16px; margin-bottom: 12px; ${isExpired ? 'opacity: 0.6;' : ''}">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; background: ${coupon.is_active ? '#fef3c7' : '#fee2e2'}; color: ${coupon.is_active ? '#92400e' : '#991b1b'};">
              ${coupon.is_active ? 'âœ… Aktiv' : 'âŒ Inaktiv'}
            </span>
          </div>
          <div>
            <h3 style="color: #111827; font-size: 16px; margin-bottom: 6px;">ğŸ´ ${coupon.product}</h3>
            <div style="font-size: 18px; font-weight: 700; color: #F9A825; margin: 6px 0;">ğŸ’° ${coupon.price}</div>
            ${descHTML}
            <p style="font-size: 13px; color: #6b7280; margin: 4px 0;">ğŸ“… GÃ¼ltig: ${startDate.toLocaleDateString('de-DE')} - ${endDate.toLocaleDateString('de-DE')}</p>
            <span style="background: ${statusBg}; color: ${statusColor}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; display: inline-block; margin-top: 4px;">
              ${statusText}
            </span>
            ${activationsHTML}
          </div>
        </div>
      `
    }
    
    showResult('result-coupon-load', '', 'success')
  } catch (e) { 
    showResult('result-coupon-load', 'âŒ Fehler: ' + e.message, 'error') 
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded', function() {
  loadCoupons()
  
  // âœ… NEU: Produkt-Dropdown fÃ¼llen
  const productSelect = document.getElementById('couponProduct')
  MENU_PRODUCTS.forEach(product => {
    const option = document.createElement('option')
    option.value = product.name
    option.textContent = `${product.name} (${product.price.toFixed(2)}â‚¬)`
    productSelect.appendChild(option)
  })
  
  // Datum-Felder vorbelegen
  const today = new Date()
  const todayStr = today.toISOString().split('T')[0]
  document.getElementById('couponStart').value = todayStr
  document.getElementById('couponEnd').value = todayStr
})
</script>
</body>
</html>
