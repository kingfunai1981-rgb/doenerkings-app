<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ D√∂ner Boxx - Vollst√§ndiger System-Test</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 32px; margin-bottom: 10px; }
    .header p { opacity: 0.9; font-size: 14px; }
    
    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
      overflow-x: auto;
    }
    .tab {
      padding: 15px 20px;
      cursor: pointer;
      border: none;
      background: none;
      font-size: 14px;
      font-weight: 600;
      color: #666;
      white-space: nowrap;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }
    .tab:hover { background: #e9ecef; }
    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      background: white;
    }
    
    .content {
      padding: 30px;
      max-height: 70vh;
      overflow-y: auto;
    }
    .test-category {
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      overflow: hidden;
    }
    .category-header {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
    }
    .category-header:hover { background: #e9ecef; }
    .category-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 16px;
      font-weight: 700;
    }
    .category-stats {
      display: flex;
      gap: 15px;
      font-size: 13px;
    }
    .stat { display: flex; align-items: center; gap: 5px; }
    .stat.pass { color: #22c55e; font-weight: 600; }
    .stat.fail { color: #ef4444; font-weight: 600; }
    .stat.pending { color: #f59e0b; font-weight: 600; }
    
    .category-content {
      padding: 20px;
      display: none;
    }
    .category-content.show { display: block; }
    
    .test-item {
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      align-items: start;
      gap: 15px;
      transition: all 0.3s;
    }
    .test-item:hover { border-color: #667eea; }
    .test-item.pass { background: #f0fdf4; border-color: #22c55e; }
    .test-item.fail { background: #fef2f2; border-color: #ef4444; }
    
    .checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.3s;
    }
    .checkbox:hover { border-color: #667eea; }
    .checkbox.checked {
      background: #22c55e;
      border-color: #22c55e;
    }
    .checkbox.checked::after {
      content: '‚úì';
      color: white;
      font-weight: 700;
      font-size: 16px;
    }
    .checkbox.failed {
      background: #ef4444;
      border-color: #ef4444;
    }
    .checkbox.failed::after {
      content: '‚úó';
      color: white;
      font-weight: 700;
      font-size: 16px;
    }
    
    .test-content { flex: 1; }
    .test-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 6px;
      color: #333;
    }
    .test-description {
      font-size: 13px;
      color: #666;
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .test-steps {
      font-size: 12px;
      color: #888;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      margin-top: 8px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .test-expected {
      font-size: 12px;
      color: #22c55e;
      font-weight: 600;
      margin-top: 6px;
    }
    
    .test-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn-test {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-pass {
      background: #22c55e;
      color: white;
    }
    .btn-pass:hover { background: #16a34a; }
    .btn-fail {
      background: #ef4444;
      color: white;
    }
    .btn-fail:hover { background: #dc2626; }
    .btn-reset {
      background: #6b7280;
      color: white;
    }
    .btn-reset:hover { background: #4b5563; }
    
    .summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    .summary h3 {
      font-size: 18px;
      margin-bottom: 15px;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      transition: width 0.5s;
      width: 0%;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #e9ecef;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #667eea;
    }
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .floating-actions {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }
    .floating-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      background: #667eea;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(102,126,234,0.4);
      transition: all 0.3s;
    }
    .floating-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(102,126,234,0.6);
    }
    
    @media (max-width: 768px) {
      body { padding: 10px; }
      .content { padding: 15px; max-height: 60vh; }
      .tab { padding: 12px 15px; font-size: 13px; }
      .test-item { flex-direction: column; }
      .floating-actions {
        bottom: 20px;
        right: 20px;
      }
      .floating-btn {
        width: 48px;
        height: 48px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üß™ Vollst√§ndiger System-Test</h1>
    <p>Teste alle Funktionen deines D√∂ner Boxx Loyalty Systems</p>
  </div>
  
  <div class="tabs" id="tabs-container">
    <!-- Tabs werden dynamisch erstellt -->
  </div>
  
  <div class="content">
    <div class="summary">
      <h3>üìä Gesamt-Fortschritt</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="total-progress"></div>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-tests">0</div>
          <div class="stat-label">Gesamt</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: #22c55e;" id="passed-tests">0</div>
          <div class="stat-label">‚úÖ Bestanden</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: #ef4444;" id="failed-tests">0</div>
          <div class="stat-label">‚ùå Fehlgeschlagen</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: #f59e0b;" id="pending-tests">0</div>
          <div class="stat-label">‚è≥ Offen</div>
        </div>
      </div>
    </div>
    
    <div id="test-content">
      <!-- Wird dynamisch geladen -->
    </div>
  </div>
</div>

<div class="floating-actions">
  <button class="floating-btn" onclick="resetAll()" title="Alle zur√ºcksetzen">üîÑ</button>
  <button class="floating-btn" onclick="exportResults()" title="Export">üìä</button>
</div>

<script>
// Vereinfachte Test-Daten (die wichtigsten Tests)
const tests = {
  index: {
    name: 'üì± Index App',
    icon: 'üì±',
    categories: [
      {
        name: '1. Registrierung & Login',
        tests: [
          {
            title: 'Neue Registrierung',
            desc: 'Kunde kann sich neu registrieren',
            steps: '1. App √∂ffnen\n2. Rufnummer eingeben (z.B. 0151123456)\n3. Name eingeben\n4. "Registrieren" klicken',
            expected: '‚úÖ Erfolgsmeldung + automatischer Login + QR-Code wird generiert'
          },
          {
            title: 'Login via Telefonnummer',
            desc: 'Kunde kann sich mit existierender Nummer anmelden',
            steps: '1. Logout (falls angemeldet)\n2. Rufnummer eingeben (existierende)\n3. "Anmelden" klicken',
            expected: '‚úÖ Login erfolgreich + Punktestand wird angezeigt'
          }
        ]
      },
      {
        name: '2. WhatsApp-Benachrichtigungen',
        tests: [
          {
            title: 'WhatsApp-Text korrekt',
            desc: 'Opt-In Text enth√§lt KEIN "STOP" mehr!',
            steps: '1. "WhatsApp aktivieren" klicken\n2. WhatsApp-Text lesen',
            expected: '‚úÖ Text: "Abmeldung hier in meinem Kundenkonto m√∂glich" (KEIN "STOP"!)'
          },
          {
            title: 'WhatsApp aktivieren',
            desc: 'Kunde kann WhatsApp-Nachrichten aktivieren',
            steps: '1. Zu WhatsApp-Section scrollen\n2. "Jetzt aktivieren" klicken\n3. WhatsApp √∂ffnet sich\n4. Nachricht senden',
            expected: '‚úÖ WhatsApp √∂ffnet sich mit vorbef√ºlltem Text + Status √§ndert sich zu "Aktiviert"'
          },
          {
            title: 'UI nach Aktivierung - NEUE POSITION',
            desc: 'Nach Aktivierung: Kompakter Block UNTER Pr√§mien!',
            steps: '1. WhatsApp aktivieren\n2. UI ansehen\n3. Nach unten scrollen',
            expected: '‚úÖ Kleiner gr√ºner Block + UNTER den Pr√§mien + keine gro√üe Info-Box mehr'
          },
          {
            title: 'WhatsApp deaktivieren',
            desc: 'Kunde kann sich wieder abmelden',
            steps: '1. Bei aktiviertem WhatsApp nach unten scrollen\n2. "Deaktivieren" klicken\n3. Best√§tigen',
            expected: '‚úÖ Status √§ndert sich zu "Deaktiviert" + Best√§tigung'
          }
        ]
      },
      {
        name: '3. Pr√§mien einl√∂sen',
        tests: [
          {
            title: 'Pr√§mie einl√∂sen (genug Punkte)',
            desc: 'Kunde kann Pr√§mie einl√∂sen wenn genug Punkte',
            steps: '1. Pr√§mie w√§hlen (z.B. Ayran 250P)\n2. "Einl√∂sen" klicken\n3. Best√§tigen',
            expected: '‚úÖ Punkte werden abgezogen + Best√§tigung + erscheint unter "Wartet auf Best√§tigung"'
          }
        ]
      },
      {
        name: '4. Gl√ºcksrad',
        tests: [
          {
            title: 'Gl√ºcksrad drehen',
            desc: 'Kunde kann Gl√ºcksrad drehen',
            steps: '1. "Jetzt drehen" klicken\n2. Animation abwarten\n3. Gewinn ansehen',
            expected: '‚úÖ Rad dreht sich + Gewinn wird angezeigt + Punkte gutgeschrieben'
          }
        ]
      },
      {
        name: '5. Mobile-Bug-Fix',
        tests: [
          {
            title: 'Nach 15 Min Inaktivit√§t - BUG GEFIXT!',
            desc: 'KEIN Fehlermeldungs-Loop mehr!',
            steps: '1. App √∂ffnen, anmelden\n2. Handy sperren\n3. 15 Minuten warten\n4. Handy entsperren',
            expected: '‚úÖ App l√§dt normal weiter + KEINE Fehler-Pop-ups mehr!'
          }
        ]
      }
    ]
  },
  
  scanner: {
    name: 'üì∑ Scanner App',
    icon: 'üì∑',
    categories: [
      {
        name: '1. QR-Code Scannen',
        tests: [
          {
            title: 'QR-Code scannen',
            desc: 'Scanner erkennt Kunden-QR',
            steps: '1. Scanner √∂ffnen\n2. Kunden-QR scannen\n3. Kundendaten sollten laden',
            expected: '‚úÖ Kundendaten werden angezeigt + Punktestand sichtbar'
          }
        ]
      },
      {
        name: '2. Punkte gutschreiben',
        tests: [
          {
            title: 'Punkte via QR',
            desc: 'Punkte f√ºr Bestellung gutschreiben',
            steps: '1. QR scannen\n2. Betrag eingeben (z.B. 10.00‚Ç¨)\n3. "Gutschreiben" klicken',
            expected: '‚úÖ Punkte werden berechnet (10‚Ç¨ = 100P) + gutgeschrieben + Best√§tigung'
          },
          {
            title: 'Punkte via Telefonnummer',
            desc: 'Kunde ohne Handy kann auch Punkte bekommen',
            steps: '1. "Telefon" Tab\n2. Nummer eingeben (z.B. 0151123456)\n3. Betrag eingeben\n4. Gutschreiben',
            expected: '‚úÖ Kunde wird gefunden + Punkte gutgeschrieben'
          }
        ]
      },
      {
        name: '3. Pr√§mien best√§tigen',
        tests: [
          {
            title: 'Pr√§mie best√§tigen',
            desc: 'Scanner kann Pr√§mie best√§tigen',
            steps: '1. In Index: Pr√§mie einl√∂sen (z.B. Ayran)\n2. In Scanner: QR scannen\n3. Unter "Wartet auf Best√§tigung"\n4. "Best√§tigen" klicken',
            expected: '‚úÖ Pr√§mie verschwindet aus Liste + Best√§tigung'
          }
        ]
      }
    ]
  },
  
  admin: {
    name: 'üë®‚Äçüíº Admin Panel',
    icon: 'üë®‚Äçüíº',
    categories: [
      {
        name: '1. Kunden verwalten',
        tests: [
          {
            title: 'Kunden-Liste laden',
            desc: 'Alle Kunden werden aufgelistet',
            steps: '1. "Kunden verwalten" √∂ffnen',
            expected: '‚úÖ Liste mit allen Kunden + Suche funktioniert'
          },
          {
            title: 'Punkte manuell hinzuf√ºgen',
            desc: 'Admin kann Punkte korrigieren',
            steps: '1. Kunde w√§hlen\n2. Punkte eingeben (z.B. +100)\n3. "Hinzuf√ºgen" klicken',
            expected: '‚úÖ Punkte werden gutgeschrieben + in DB gespeichert'
          }
        ]
      },
      {
        name: '2. WhatsApp-Marketing',
        tests: [
          {
            title: 'Opt-In Liste exportieren',
            desc: 'Admin kann WhatsApp-Nummern exportieren',
            steps: '1. "WhatsApp Marketing"\n2. "Nummern exportieren" klicken',
            expected: '‚úÖ Liste mit allen Opt-In Nummern + zum Kopieren'
          },
          {
            title: 'Opt-In Statistik',
            desc: 'Dashboard zeigt wie viele aktiviert haben',
            steps: '1. WhatsApp-Section ansehen',
            expected: '‚úÖ "X Kunden haben WhatsApp aktiviert" + Prozentsatz'
          }
        ]
      },
      {
        name: '3. Happy Hour',
        tests: [
          {
            title: 'Happy Hour aktivieren',
            desc: 'Doppelte Punkte f√ºr alle',
            steps: '1. "Global Bonuses"\n2. "Happy Hour"\n3. Zeitraum w√§hlen (z.B. 15:00-18:00)\n4. Aktivieren',
            expected: '‚úÖ Alle Punkte-Gutschriften werden verdoppelt in diesem Zeitraum'
          },
          {
            title: 'Happy Hour - Zeitpr√ºfung VORHER',
            desc: 'Bonus gilt nicht vor Startzeit',
            steps: '1. Happy Hour: 15:00-18:00\n2. Um 14:59 Punkte gutschreiben\n3. Pr√ºfen',
            expected: '‚úÖ Normale Punkte (NICHT doppelt)'
          },
          {
            title: 'Happy Hour - Zeitpr√ºfung W√ÑHREND',
            desc: 'Bonus gilt w√§hrend Zeitraum',
            steps: '1. Happy Hour: 15:00-18:00\n2. Um 16:00 Punkte gutschreiben (10‚Ç¨ = 100P)\n3. Pr√ºfen',
            expected: '‚úÖ 200 Punkte gutgeschrieben (doppelt!)'
          },
          {
            title: 'Happy Hour - Zeitpr√ºfung NACHHER',
            desc: 'Bonus gilt nicht nach Endzeit',
            steps: '1. Happy Hour: 15:00-18:00\n2. Um 18:01 Punkte gutschreiben\n3. Pr√ºfen',
            expected: '‚úÖ Normale Punkte (NICHT doppelt)'
          }
        ]
      }
    ]
  },
  
  security: {
    name: 'üîí Sicherheit',
    icon: 'üîí',
    categories: [
      {
        name: '1. Punkte-Limits',
        tests: [
          {
            title: 'Sperre bei 40‚Ç¨ Bestellung',
            desc: 'Scanner muss doppelt best√§tigen',
            steps: '1. Scanner\n2. Betrag: 40‚Ç¨ eingeben\n3. Gutschreiben',
            expected: '‚úÖ Warnung: "Hoher Betrag! Wirklich gutschreiben?"'
          },
          {
            title: 'Sperre bei 100‚Ç¨+ Bestellung',
            desc: 'Masterpin erforderlich',
            steps: '1. Scanner\n2. Betrag: 105‚Ç¨ eingeben\n3. Gutschreiben',
            expected: '‚úÖ Masterpin-Abfrage + nur bei korrektem Pin m√∂glich'
          },
          {
            title: 'Normaler Betrag ohne Sperre',
            desc: 'Kleine Betr√§ge funktionieren sofort',
            steps: '1. Betrag: 15‚Ç¨ eingeben\n2. Gutschreiben',
            expected: '‚úÖ Keine Warnung + sofort gutgeschrieben'
          }
        ]
      }
    ]
  }
}

// State
let currentTab = 'index'
let testStates = {}

// Initialize
function init() {
  loadStates()
  createTabs()
  showTab('index')
  updateSummary()
}

function createTabs() {
  const tabsContainer = document.getElementById('tabs-container')
  let tabsHTML = ''
  
  Object.keys(tests).forEach((key, index) => {
    const tab = tests[key]
    const activeClass = index === 0 ? 'active' : ''
    tabsHTML += `<button class="tab ${activeClass}" data-tab="${key}">${tab.icon} ${tab.name}</button>`
  })
  
  tabsContainer.innerHTML = tabsHTML
  
  // Event Listeners
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.getAttribute('data-tab')
      showTab(tabName)
    })
  })
}

function loadStates() {
  const saved = localStorage.getItem('doener-test-states')
  if (saved) {
    try {
      testStates = JSON.parse(saved)
    } catch (e) {
      console.error('Error loading states:', e)
      testStates = {}
    }
  }
}

function saveStates() {
  localStorage.setItem('doener-test-states', JSON.stringify(testStates))
  updateSummary()
}

function showTab(tabName) {
  currentTab = tabName
  
  // Update tabs
  document.querySelectorAll('.tab').forEach(tab => {
    if (tab.getAttribute('data-tab') === tabName) {
      tab.classList.add('active')
    } else {
      tab.classList.remove('active')
    }
  })
  
  // Render content
  renderTests(tabName)
}

function renderTests(tabName) {
  const testData = tests[tabName]
  if (!testData) return
  
  const container = document.getElementById('test-content')
  let html = ''
  
  testData.categories.forEach((category, catIndex) => {
    const categoryId = `${tabName}-${catIndex}`
    const categoryTests = category.tests
    const passedCount = categoryTests.filter((t, idx) => getTestState(categoryId, idx) === 'pass').length
    const failedCount = categoryTests.filter((t, idx) => getTestState(categoryId, idx) === 'fail').length
    const pendingCount = categoryTests.length - passedCount - failedCount
    
    html += `
      <div class="test-category">
        <div class="category-header" onclick="toggleCategory('${categoryId}')">
          <div class="category-title">
            <span>${category.name}</span>
          </div>
          <div class="category-stats">
            <div class="stat pass">‚úÖ ${passedCount}</div>
            <div class="stat fail">‚ùå ${failedCount}</div>
            <div class="stat pending">‚è≥ ${pendingCount}</div>
          </div>
        </div>
        <div class="category-content show" id="${categoryId}">
    `
    
    category.tests.forEach((test, testIndex) => {
      const state = getTestState(categoryId, testIndex)
      const stateClass = state || ''
      
      html += `
        <div class="test-item ${stateClass}">
          <div class="checkbox ${state === 'pass' ? 'checked' : ''} ${state === 'fail' ? 'failed' : ''}" 
               onclick="toggleTest('${categoryId}', ${testIndex})"></div>
          <div class="test-content">
            <div class="test-title">${test.title}</div>
            <div class="test-description">${test.desc}</div>
            <div class="test-steps"><strong>üîß Schritte:</strong>${test.steps}</div>
            <div class="test-expected"><strong>‚úÖ Erwartet:</strong> ${test.expected}</div>
            <div class="test-actions">
              <button class="btn-test btn-pass" onclick="setTestState('${categoryId}', ${testIndex}, 'pass'); event.stopPropagation();">‚úÖ Bestanden</button>
              <button class="btn-test btn-fail" onclick="setTestState('${categoryId}', ${testIndex}, 'fail'); event.stopPropagation();">‚ùå Fehlgeschlagen</button>
              <button class="btn-test btn-reset" onclick="setTestState('${categoryId}', ${testIndex}, null); event.stopPropagation();">‚Ü∫ Reset</button>
            </div>
          </div>
        </div>
      `
    })
    
    html += `
        </div>
      </div>
    `
  })
  
  container.innerHTML = html
}

function toggleCategory(categoryId) {
  const content = document.getElementById(categoryId)
  if (content) {
    content.classList.toggle('show')
  }
}

function getTestState(categoryId, testIndex) {
  const key = `${categoryId}-${testIndex}`
  return testStates[key] || null
}

function setTestState(categoryId, testIndex, state) {
  const key = `${categoryId}-${testIndex}`
  if (state === null) {
    delete testStates[key]
  } else {
    testStates[key] = state
  }
  saveStates()
  renderTests(currentTab)
}

function toggleTest(categoryId, testIndex) {
  const current = getTestState(categoryId, testIndex)
  let newState = null
  if (!current) newState = 'pass'
  else if (current === 'pass') newState = 'fail'
  else if (current === 'fail') newState = null
  
  setTestState(categoryId, testIndex, newState)
}

function updateSummary() {
  let total = 0
  let passed = 0
  let failed = 0
  
  Object.values(tests).forEach(tabData => {
    tabData.categories.forEach(category => {
      total += category.tests.length
    })
  })
  
  Object.values(testStates).forEach(state => {
    if (state === 'pass') passed++
    if (state === 'fail') failed++
  })
  
  const pending = total - passed - failed
  const progress = total > 0 ? (passed / total * 100) : 0
  
  document.getElementById('total-tests').textContent = total
  document.getElementById('passed-tests').textContent = passed
  document.getElementById('failed-tests').textContent = failed
  document.getElementById('pending-tests').textContent = pending
  document.getElementById('total-progress').style.width = progress + '%'
}

function resetAll() {
  if (confirm('Wirklich alle Test-Ergebnisse zur√ºcksetzen?')) {
    testStates = {}
    saveStates()
    renderTests(currentTab)
  }
}

function exportResults() {
  let report = '# D√∂ner Boxx System-Test Bericht\n\n'
  report += `Erstellt am: ${new Date().toLocaleString('de-DE')}\n\n`
  
  let total = 0, passed = 0, failed = 0
  
  Object.entries(tests).forEach(([tabKey, tabData]) => {
    report += `## ${tabData.name}\n\n`
    
    tabData.categories.forEach((category, catIndex) => {
      report += `### ${category.name}\n\n`
      
      category.tests.forEach((test, testIndex) => {
        const categoryId = `${tabKey}-${catIndex}`
        const state = getTestState(categoryId, testIndex)
        total++
        if (state === 'pass') passed++
        if (state === 'fail') failed++
        
        const icon = state === 'pass' ? '‚úÖ' : state === 'fail' ? '‚ùå' : '‚è≥'
        report += `${icon} **${test.title}**: ${test.desc}\n`
      })
      
      report += '\n'
    })
  })
  
  const pending = total - passed - failed
  report += `\n## Zusammenfassung\n\n`
  report += `- Total: ${total}\n`
  report += `- Bestanden: ${passed}\n`
  report += `- Fehlgeschlagen: ${failed}\n`
  report += `- Offen: ${pending}\n`
  report += `- Erfolgsrate: ${(passed/total*100).toFixed(1)}%\n`
  
  // Download
  const blob = new Blob([report], { type: 'text/markdown' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `doener-boxx-test-${Date.now()}.md`
  a.click()
  URL.revokeObjectURL(url)
}

// Start
window.onload = init
</script>

</body>
</html>
